{"ast":null,"code":"var _jsxFileName = \"/frontend/src/camera_image.tsx\",\n  _s = $RefreshSig$();\n// camera_image.tsx\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport ThumbnailImage from './ThumbnailImage';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst CameraComponent = () => {\n  _s();\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const [imageDataUrl, setImageDataUrl] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const navigate = useNavigate();\n\n  // カメラ起動\n  useEffect(() => {\n    const startCamera = async () => {\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: {\n            facingMode: 'environment'\n          },\n          audio: false\n        });\n        if (videoRef.current) {\n          videoRef.current.srcObject = stream;\n        }\n      } catch (err) {\n        console.error('カメラの起動に失敗しました:', err);\n      }\n    };\n    startCamera();\n  }, []);\n\n  // 撮影\n  const handleCapture = () => {\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    if (!video || !canvas) return;\n    const context = canvas.getContext('2d');\n    if (!context) return;\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n    context.drawImage(video, 0, 0, canvas.width, canvas.height);\n    const dataUrl = canvas.toDataURL('image/png');\n    setImageDataUrl(dataUrl);\n  };\n\n  // 画像送信・推論・遷移\n  const handleUpload = async () => {\n    if (!imageDataUrl) return;\n    setLoading(true);\n    try {\n      const blob = await (await fetch(imageDataUrl)).blob();\n      const formData = new FormData();\n      formData.append('image', blob, 'photo.png');\n      const response = await fetch('https://your-flask-backend.onrender.com/predict', {\n        method: 'POST',\n        body: formData\n      });\n      if (!response.ok) throw new Error('バックエンドエラー');\n      const result = await response.json();\n      const imgSrc = `data:image/jpeg;base64,${result.image}`;\n\n      // labels を取得（なければ空配列）\n      const labels = Array.isArray(result.labels) ? result.labels : [];\n      const labelString = labels.length > 0 ? labels.join(', ') : '？？？';\n\n      // 遷移先に画像とラベルを渡して遷移\n      navigate('/fullscreen', {\n        state: {\n          imageSrc: imgSrc,\n          label: labelString\n        }\n      });\n    } catch (err) {\n      console.error(err);\n      alert('❌ 画像の送信に失敗しました');\n    } finally {\n      setLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      textAlign: 'center'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"video\", {\n      ref: videoRef,\n      width: \"640\",\n      height: \"480\",\n      autoPlay: true,\n      playsInline: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"shutter-button\",\n      onClick: handleCapture,\n      children: /*#__PURE__*/_jsxDEV(\"svg\", {\n        xmlns: \"http://www.w3.org/2000/svg\",\n        viewBox: \"0 0 24 24\",\n        width: \"30\",\n        height: \"30\",\n        className: \"camera-icon\",\n        children: /*#__PURE__*/_jsxDEV(\"path\", {\n          d: \"M12 10c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4zm0 6c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM3 6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-3l-2-2h-4l-2 2H3zm0 14V8h18v12H3z\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 14\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 12\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        display: 'none'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: '1rem'\n      },\n      children: loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"loading-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"loading-spinner\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 13\n        }, this), \" \", /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"< \\u30AB\\u30E1\\u30E9\\u8D77\\u52D5 > \\u3092\\u30AF\\u30EA\\u30C3\\u30AF\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 11\n      }, this) : imageDataUrl && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(ThumbnailImage, {\n          imageSrc: imageDataUrl,\n          onClick: handleUpload\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n          href: imageDataUrl,\n          download: \"photo.png\",\n          children: \"\\u753B\\u50CF\\u3092\\u4FDD\\u5B58\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 89,\n    columnNumber: 5\n  }, this);\n};\n_s(CameraComponent, \"6m4DooENwyABlhWP/50VJyjfqb0=\", false, function () {\n  return [useNavigate];\n});\n_c = CameraComponent;\nexport default CameraComponent;\nvar _c;\n$RefreshReg$(_c, \"CameraComponent\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useNavigate","ThumbnailImage","jsxDEV","_jsxDEV","Fragment","_Fragment","CameraComponent","_s","videoRef","canvasRef","imageDataUrl","setImageDataUrl","loading","setLoading","navigate","startCamera","stream","navigator","mediaDevices","getUserMedia","video","facingMode","audio","current","srcObject","err","console","error","handleCapture","canvas","context","getContext","width","videoWidth","height","videoHeight","drawImage","dataUrl","toDataURL","handleUpload","blob","fetch","formData","FormData","append","response","method","body","ok","Error","result","json","imgSrc","image","labels","Array","isArray","labelString","length","join","state","imageSrc","label","alert","style","textAlign","children","ref","autoPlay","playsInline","fileName","_jsxFileName","lineNumber","columnNumber","className","onClick","xmlns","viewBox","d","display","marginTop","href","download","_c","$RefreshReg$"],"sources":["/frontend/src/camera_image.tsx"],"sourcesContent":["// camera_image.tsx\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport ThumbnailImage from './ThumbnailImage';\n\nconst CameraComponent: React.FC = () => {\n  const videoRef = useRef<HTMLVideoElement | null>(null);\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\n  const [imageDataUrl, setImageDataUrl] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n  const navigate = useNavigate();\n\n  // カメラ起動\n  useEffect(() => {\n    const startCamera = async () => {\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: { facingMode: 'environment' },\n          audio: false,\n        });\n        if (videoRef.current) {\n          videoRef.current.srcObject = stream;\n        }\n      } catch (err) {\n        console.error('カメラの起動に失敗しました:', err);\n      }\n    };\n    startCamera();\n  }, []);\n\n  // 撮影\n  const handleCapture = () => {\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    if (!video || !canvas) return;\n\n    const context = canvas.getContext('2d');\n    if (!context) return;\n\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n    context.drawImage(video, 0, 0, canvas.width, canvas.height);\n\n    const dataUrl = canvas.toDataURL('image/png');\n    setImageDataUrl(dataUrl);\n  };\n\n  // 画像送信・推論・遷移\n  const handleUpload = async () => {\n    if (!imageDataUrl) return;\n    setLoading(true);\n\n    try {\n      const blob = await (await fetch(imageDataUrl)).blob();\n      const formData = new FormData();\n      formData.append('image', blob, 'photo.png');\n\n      const response = await fetch('https://your-flask-backend.onrender.com/predict', {\n        method: 'POST',\n        body: formData,\n      });\n\n      if (!response.ok) throw new Error('バックエンドエラー');\n\n      const result = await response.json();\n      const imgSrc = `data:image/jpeg;base64,${result.image}`;\n\n      // labels を取得（なければ空配列）\n      const labels = Array.isArray(result.labels) ? result.labels : [];\n      const labelString = labels.length > 0 ? labels.join(', ') : '？？？';\n\n      // 遷移先に画像とラベルを渡して遷移\n      navigate('/fullscreen', {\n        state: {\n          imageSrc: imgSrc,\n          label: labelString,\n        },\n      });\n\n    } catch (err) {\n      console.error(err);\n      alert('❌ 画像の送信に失敗しました');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div style={{ textAlign: 'center' }}>\n      <video ref={videoRef} width=\"640\" height=\"480\" autoPlay playsInline />\n      <br />\n      <button className=\"shutter-button\" onClick={handleCapture}>\n           <svg\n             xmlns=\"http://www.w3.org/2000/svg\"\n             viewBox=\"0 0 24 24\"\n             width=\"30\"\n             height=\"30\"\n             className=\"camera-icon\"\n           >\n             <path d=\"M12 10c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4zm0 6c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM3 6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-3l-2-2h-4l-2 2H3zm0 14V8h18v12H3z\" />\n           </svg>\n         </button>\n\n      <canvas ref={canvasRef} style={{ display: 'none' }} />\n\n      <div style={{ marginTop: '1rem' }}>\n        {loading ? (\n          <div className=\"loading-container\">\n            <div className=\"loading-spinner\"></div> {/* ローディングアニメーション */}\n            <p>&lt; カメラ起動 &gt; をクリック</p>\n          </div>\n        ) : (\n          imageDataUrl && (\n            <>\n              <ThumbnailImage imageSrc={imageDataUrl} onClick={handleUpload} />\n              <br />\n              <a href={imageDataUrl} download=\"photo.png\">画像を保存</a>\n            </>\n          )\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default CameraComponent;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}