{"ast":null,"code":"var _jsxFileName = \"/frontend/src/camera_image.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport ThumbnailImage from './ThumbnailImage';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst CameraComponent = () => {\n  _s();\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const [imageDataUrl, setImageDataUrl] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const navigate = useNavigate();\n  useEffect(() => {\n    const video = videoRef.current; // ここで一旦コピー\n\n    const startCamera = async () => {\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: {\n            facingMode: 'environment'\n          },\n          audio: false\n        });\n        if (video) {\n          video.srcObject = stream;\n        }\n      } catch (err) {\n        console.error('カメラの起動に失敗しました:', err);\n        alert('カメラの起動に失敗しました。カメラが接続されているか、ブラウザの権限設定をご確認ください。');\n      }\n    };\n    startCamera();\n    return () => {\n      if (video !== null && video !== void 0 && video.srcObject) {\n        video.srcObject.getTracks().forEach(track => track.stop());\n      }\n    };\n  }, []);\n  const handleCapture = () => {\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    if (!video || !canvas) return;\n    const context = canvas.getContext('2d');\n    if (!context) return;\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n    context.drawImage(video, 0, 0, canvas.width, canvas.height);\n    const dataUrl = canvas.toDataURL('image/png');\n    setImageDataUrl(dataUrl);\n  };\n  const handleUpload = async () => {\n    if (!imageDataUrl) return;\n    setLoading(true);\n    try {\n      navigate('/alfred', {\n        state: {\n          imageDataUrl\n        }\n      });\n    } catch (err) {\n      console.error(err);\n      alert('❌ 画像の送信に失敗しました');\n    } finally {\n      setLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      textAlign: 'center'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"video\", {\n      ref: videoRef,\n      width: \"640\",\n      height: \"480\",\n      autoPlay: true,\n      playsInline: true,\n      style: {\n        borderRadius: 8,\n        backgroundColor: '#000'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"shutter-button\",\n      onClick: handleCapture,\n      disabled: loading,\n      \"aria-label\": \"\\u5199\\u771F\\u3092\\u64AE\\u308B\",\n      children: /*#__PURE__*/_jsxDEV(\"svg\", {\n        xmlns: \"http://www.w3.org/2000/svg\",\n        viewBox: \"0 0 24 24\",\n        width: \"30\",\n        height: \"30\",\n        className: \"camera-icon\",\n        children: /*#__PURE__*/_jsxDEV(\"path\", {\n          d: \"M12 10c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4zm0 6c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM3 6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-3l-2-2h-4l-2 2H3zm0 14V8h18v12H3z\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        display: 'none'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: '1rem'\n      },\n      children: loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"loading-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"loading-spinner\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"\\u51E6\\u7406\\u4E2D\\u2026\\u5C11\\u3005\\u304A\\u5F85\\u3061\\u304F\\u3060\\u3055\\u3044\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 11\n      }, this) : imageDataUrl && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(ThumbnailImage, {\n          imageSrc: imageDataUrl,\n          onClick: handleUpload\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n          href: imageDataUrl,\n          download: \"photo.png\",\n          children: \"\\u753B\\u50CF\\u3092\\u4FDD\\u5B58\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 75,\n    columnNumber: 5\n  }, this);\n};\n_s(CameraComponent, \"6m4DooENwyABlhWP/50VJyjfqb0=\", false, function () {\n  return [useNavigate];\n});\n_c = CameraComponent;\nexport default CameraComponent;\nvar _c;\n$RefreshReg$(_c, \"CameraComponent\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useNavigate","ThumbnailImage","jsxDEV","_jsxDEV","Fragment","_Fragment","CameraComponent","_s","videoRef","canvasRef","imageDataUrl","setImageDataUrl","loading","setLoading","navigate","video","current","startCamera","stream","navigator","mediaDevices","getUserMedia","facingMode","audio","srcObject","err","console","error","alert","getTracks","forEach","track","stop","handleCapture","canvas","context","getContext","width","videoWidth","height","videoHeight","drawImage","dataUrl","toDataURL","handleUpload","state","style","textAlign","children","ref","autoPlay","playsInline","borderRadius","backgroundColor","fileName","_jsxFileName","lineNumber","columnNumber","className","onClick","disabled","xmlns","viewBox","d","display","marginTop","imageSrc","href","download","_c","$RefreshReg$"],"sources":["/frontend/src/camera_image.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport ThumbnailImage from './ThumbnailImage';\n\nconst CameraComponent: React.FC = () => {\n  const videoRef = useRef<HTMLVideoElement | null>(null);\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\n  const [imageDataUrl, setImageDataUrl] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    const video = videoRef.current;  // ここで一旦コピー\n  \n    const startCamera = async () => {\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: { facingMode: 'environment' },\n          audio: false,\n        });\n        if (video) {\n          video.srcObject = stream;\n        }\n      } catch (err) {\n        console.error('カメラの起動に失敗しました:', err);\n        alert('カメラの起動に失敗しました。カメラが接続されているか、ブラウザの権限設定をご確認ください。');\n      }\n    };\n    startCamera();\n  \n    return () => {\n      if (video?.srcObject) {\n        (video.srcObject as MediaStream)\n          .getTracks()\n          .forEach((track) => track.stop());\n      }\n    };\n  }, []);\n\n  const handleCapture = () => {\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    if (!video || !canvas) return;\n\n    const context = canvas.getContext('2d');\n    if (!context) return;\n\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n    context.drawImage(video, 0, 0, canvas.width, canvas.height);\n\n    const dataUrl = canvas.toDataURL('image/png');\n    setImageDataUrl(dataUrl);\n  };\n\n  const handleUpload = async () => {\n    if (!imageDataUrl) return;\n    setLoading(true);\n\n    try {\n      navigate('/alfred', {\n        state: {\n          imageDataUrl,\n        },\n      });\n    } catch (err) {\n      console.error(err);\n      alert('❌ 画像の送信に失敗しました');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div style={{ textAlign: 'center' }}>\n      <video\n        ref={videoRef}\n        width=\"640\"\n        height=\"480\"\n        autoPlay\n        playsInline\n        style={{ borderRadius: 8, backgroundColor: '#000' }}\n      />\n      <br />\n      <button\n        className=\"shutter-button\"\n        onClick={handleCapture}\n        disabled={loading}\n        aria-label=\"写真を撮る\"\n      >\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          viewBox=\"0 0 24 24\"\n          width=\"30\"\n          height=\"30\"\n          className=\"camera-icon\"\n        >\n          <path d=\"M12 10c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4zm0 6c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM3 6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-3l-2-2h-4l-2 2H3zm0 14V8h18v12H3z\" />\n        </svg>\n      </button>\n\n      <canvas ref={canvasRef} style={{ display: 'none' }} />\n\n      <div style={{ marginTop: '1rem' }}>\n        {loading ? (\n          <div className=\"loading-container\">\n            <div className=\"loading-spinner\" />\n            <p>処理中…少々お待ちください</p>\n          </div>\n        ) : (\n          imageDataUrl && (\n            <>\n              <ThumbnailImage imageSrc={imageDataUrl} onClick={handleUpload} />\n              <br />\n              <a href={imageDataUrl} download=\"photo.png\">\n                画像を保存\n              </a>\n            </>\n          )\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default CameraComponent;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}